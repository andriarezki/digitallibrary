import{j as e}from"./ui-BLu1z8d0.js";import{r as s}from"./vendor-C1mj56OW.js";import{u as a,a as l,b as r}from"./query-GwNCDiIO.js";import{a as t,e as i,i as n,g as d,j as o}from"./index-CaR8JZ7s.js";import{I as c}from"./input-YA_H6W_U.js";import{D as m,a as u,b as x,c as h,d as j,e as p}from"./dialog-VOInu2HO.js";import{P as b}from"./plus-COWK42me.js";import{S as v,T as f}from"./trash-2-D-UR2S1H.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";const g=s.forwardRef(({className:s,...a},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:t("w-full caption-bottom text-sm",s),...a})}));g.displayName="Table";const N=s.forwardRef(({className:s,...a},l)=>e.jsx("thead",{ref:l,className:t("[&_tr]:border-b",s),...a}));N.displayName="TableHeader";const w=s.forwardRef(({className:s,...a},l)=>e.jsx("tbody",{ref:l,className:t("[&_tr:last-child]:border-0",s),...a}));w.displayName="TableBody";s.forwardRef(({className:s,...a},l)=>e.jsx("tfoot",{ref:l,className:t("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})).displayName="TableFooter";const y=s.forwardRef(({className:s,...a},l)=>e.jsx("tr",{ref:l,className:t("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));y.displayName="TableRow";const k=s.forwardRef(({className:s,...a},l)=>e.jsx("th",{ref:l,className:t("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...a}));k.displayName="TableHead";const C=s.forwardRef(({className:s,...a},l)=>e.jsx("td",{ref:l,className:t("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...a}));C.displayName="TableCell";function E(){const{toast:t}=i(),E=a(),S=n(),P="admin"===(null==S?void 0:S.level)||"petugas"===(null==S?void 0:S.level),[T,U]=s.useState(!1),[F,R]=s.useState(!1),[A,D]=s.useState(!1),[L,q]=s.useState(null),[_,K]=s.useState({user:"",pass:""}),[O,z]=s.useState({user:"",pass:"",nama:"",email:"",level:""}),{data:Q,isLoading:H}=l({queryKey:["/api/users",{page:1,limit:50}]}),$=r({mutationFn:async e=>{const s=await o("POST","/api/users",e);if(!s.ok)throw new Error("Failed to add user");return s.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),t({title:"Success",description:"User added successfully"}),U(!1),K({user:"",pass:""})},onError:e=>{t({title:"Error",description:e.message||"Failed to add user",variant:"destructive"})}}),B=r({mutationFn:async e=>{const s=await o("PUT",`/api/users/${e.id}`,e.updates);if(!s.ok)throw new Error("Failed to update user");return s.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),t({title:"Success",description:"User updated successfully"}),R(!1),q(null)},onError:e=>{t({title:"Error",description:e.message||"Failed to update user",variant:"destructive"})}}),I=r({mutationFn:async e=>{const s=await o("DELETE",`/api/users/${e}`);if(!s.ok)throw new Error("Failed to delete user");return s.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["/api/users"]}),t({title:"Success",description:"User deleted successfully"}),D(!1),q(null)},onError:e=>{t({title:"Error",description:e.message||"Failed to delete user",variant:"destructive"})}}),M=(e,s)=>{K(a=>({...a,[e]:s}))},G=(e,s)=>{z(a=>({...a,[e]:s}))};return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Users Management"}),P&&e.jsxs(d,{onClick:()=>U(!0),className:"bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Add User"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto rounded-lg shadow border",children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(k,{children:"Username"}),e.jsx(k,{children:"Name"}),e.jsx(k,{children:"Email"}),e.jsx(k,{children:"Level"}),e.jsx(k,{className:"text-right",children:"Actions"})]})}),e.jsx(w,{children:H?e.jsx(y,{children:e.jsx(C,{colSpan:5,children:"Loading..."})}):(null==Q?void 0:Q.users.length)?Q.users.map(s=>e.jsxs(y,{children:[e.jsx(C,{children:s.user}),e.jsx(C,{children:s.nama||"-"}),e.jsx(C,{children:s.email||"-"}),e.jsx(C,{children:s.level||"-"}),e.jsx(C,{className:"text-right",children:P&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),z({user:e.user||"",pass:"",nama:e.nama||"",email:e.email||"",level:e.level||""}),R(!0)})(s),title:"Edit",children:e.jsx(v,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),D(!0)})(s),title:"Delete",className:"text-red-600 hover:text-red-800",children:e.jsx(f,{className:"w-4 h-4"})})]})})]},s.id_login)):e.jsx(y,{children:e.jsx(C,{colSpan:5,className:"text-center text-slate-500",children:"No users found"})})})]})})}),P&&e.jsx(m,{open:T,onOpenChange:U,children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Add New User"}),e.jsx(j,{children:"Fill in the username and password for the new user."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username *"}),e.jsx(c,{value:_.user,onChange:e=>M("user",e.target.value),placeholder:"Enter username",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password *"}),e.jsx(c,{type:"password",value:_.pass,onChange:e=>M("pass",e.target.value),placeholder:"Enter password",className:"w-full"})]})]}),e.jsxs(p,{children:[e.jsx(d,{variant:"outline",onClick:()=>U(!1),disabled:$.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{_.user&&_.pass&&$.mutate(_)},disabled:$.isPending||!_.user||!_.pass,className:"bg-primary hover:bg-blue-700",children:$.isPending?"Adding...":"Add User"})]})]})}),P&&e.jsx(m,{open:F,onOpenChange:R,children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Edit User"}),e.jsx(j,{children:"Edit the user information. Leave password blank to keep unchanged."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username *"}),e.jsx(c,{value:O.user,onChange:e=>G("user",e.target.value),placeholder:"Enter username",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),e.jsx(c,{type:"password",value:O.pass,onChange:e=>G("pass",e.target.value),placeholder:"Enter new password (leave blank to keep current)",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Name"}),e.jsx(c,{value:O.nama,onChange:e=>G("nama",e.target.value),placeholder:"Enter name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx(c,{value:O.email,onChange:e=>G("email",e.target.value),placeholder:"Enter email",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Level"}),e.jsx(c,{value:O.level,onChange:e=>G("level",e.target.value),placeholder:"Enter level (e.g. admin, user)",className:"w-full"})]})]}),e.jsxs(p,{children:[e.jsx(d,{variant:"outline",onClick:()=>R(!1),disabled:B.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{if(!L)return;const e={user:O.user,nama:O.nama,email:O.email,level:O.level};O.pass&&(e.pass=O.pass),B.mutate({id:L.id_login,updates:e})},disabled:B.isPending||!O.user,className:"bg-primary hover:bg-blue-700",children:B.isPending?"Saving...":"Save Changes"})]})]})}),P&&e.jsx(m,{open:A,onOpenChange:D,children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Delete User"}),e.jsxs(j,{children:["Are you sure you want to delete user"," ",e.jsx("b",{children:null==L?void 0:L.user}),"? This action cannot be undone."]})]}),e.jsxs(p,{children:[e.jsx(d,{variant:"outline",onClick:()=>D(!1),disabled:I.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{L&&I.mutate(L.id_login)},disabled:I.isPending,className:"bg-red-600 hover:bg-red-700",children:I.isPending?"Deleting...":"Delete"})]})]})})]})}s.forwardRef(({className:s,...a},l)=>e.jsx("caption",{ref:l,className:t("mt-4 text-sm text-muted-foreground",s),...a})).displayName="TableCaption";export{E as default};
