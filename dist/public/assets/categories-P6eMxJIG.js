import{j as e}from"./ui-DM3Dsx1x.js";import{a as s,u as a,b as t}from"./query-DVbHB3bz.js";import{b as r,i,e as l,S as n,j as d}from"./index-C2B3YKz3.js";import{C as o,a as c}from"./card-BCSTiwnc.js";import{S as m,a as x,b as u,c as h,d as j}from"./select-CpuIrgyA.js";import{D as p,a as g,b as y,c as v,e as f}from"./dialog-DQ0eAeKc.js";import{r as b}from"./vendor-C1mj56OW.js";import{P as C}from"./plus-DP_GssKz.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";const N=["Book","Journal","Proceeding","Audio Visual","Catalogue","Flyer","Training","Poster","Thesis","Report","Newspaper"];function k(){const{data:k,isLoading:w}=s({queryKey:["/api/categories"]}),S=a(),{toast:P}=r(),_=i(),E="admin"===(null==_?void 0:_.level),[F,T]=b.useState(!1),[q,A]=b.useState(!1),[V,D]=b.useState(null),[K,L]=b.useState(""),[z,O]=b.useState(!1),Q=t({mutationFn:async e=>d("POST","/api/categories",e),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/categories"]}),T(!1),L(""),P({title:"Category added successfully"})},onError:()=>{P({title:"Failed to add category",variant:"destructive"})}}),$=t({mutationFn:async e=>d("PATCH",`/api/categories/${e.id}`,{nama_kategori:e.nama_kategori}),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/categories"]}),A(!1),D(null),L(""),P({title:"Category updated successfully"})},onError:()=>{P({title:"Failed to update category",variant:"destructive"})}}),B=t({mutationFn:async e=>d("DELETE",`/api/categories/${e}`),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/categories"]}),P({title:"Category deleted successfully"})},onError:()=>{P({title:"Failed to delete category",variant:"destructive"})}});return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Categories Management"}),E&&e.jsxs(l,{onClick:()=>{L(""),O(!1),T(!0)},className:"bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Category"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(o,{children:e.jsx(c,{className:"p-6",children:w?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-slate-200 rounded-lg",children:[e.jsx(n,{className:"h-4 w-48"}),e.jsx(n,{className:"h-8 w-20"})]},a))}):e.jsx("div",{className:"space-y-4",children:null==k?void 0:k.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-slate-900",children:s.nama_kategori}),e.jsxs("p",{className:"text-sm text-slate-500",children:["ID: ",s.id_kategori]})]}),E&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>(e=>{D(e),L(e.nama_kategori);const s=N.includes(e.nama_kategori);O(!s),A(!0)})(s),children:"Edit"}),e.jsx(l,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-800",onClick:()=>(e=>{window.confirm("Are you sure you want to delete this category?")&&B.mutate(e.id_kategori)})(s),children:"Delete"})]})]},s.id_kategori))})})})}),E&&e.jsx(p,{open:F,onOpenChange:T,children:e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(v,{children:"Add New Category"})}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Category Type"}),e.jsxs(m,{value:z?"custom":"predefined",onValueChange:e=>{O("custom"===e),"predefined"===e&&L("")},children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select category type"})}),e.jsxs(h,{children:[e.jsx(j,{value:"predefined",children:"Predefined Category"}),e.jsx(j,{value:"custom",children:"Custom Category"})]})]})]}),z?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Custom Category Name"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Enter custom category name",value:K,onChange:e=>L(e.target.value)})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Select Predefined Category"}),e.jsxs(m,{value:K,onValueChange:L,children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Choose a category"})}),e.jsx(h,{children:N.map(s=>e.jsx(j,{value:s,children:s},s))})]})]})]}),e.jsx(f,{children:e.jsx(l,{onClick:()=>{K.trim()&&Q.mutate({nama_kategori:K})},disabled:Q.isPending||!K.trim(),children:"Save"})})]})}),E&&e.jsx(p,{open:q,onOpenChange:A,children:e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(v,{children:"Edit Category"})}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Category Type"}),e.jsxs(m,{value:z?"custom":"predefined",onValueChange:e=>{if(O("custom"===e),"predefined"===e){const e=N.find(e=>e.toLowerCase()===K.toLowerCase());L(e||"")}},children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select category type"})}),e.jsxs(h,{children:[e.jsx(j,{value:"predefined",children:"Predefined Category"}),e.jsx(j,{value:"custom",children:"Custom Category"})]})]})]}),z?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Custom Category Name"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Enter custom category name",value:K,onChange:e=>L(e.target.value)})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-900 block mb-2",children:"Select Predefined Category"}),e.jsxs(m,{value:K,onValueChange:L,children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Choose a category"})}),e.jsx(h,{children:N.map(s=>e.jsx(j,{value:s,children:s},s))})]})]})]}),e.jsx(f,{children:e.jsx(l,{onClick:()=>{V&&K.trim()&&$.mutate({id:V.id_kategori,nama_kategori:K})},disabled:$.isPending||!K.trim(),children:"Save"})})]})})]})}export{k as default};
