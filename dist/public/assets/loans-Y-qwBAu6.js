import{j as e}from"./ui-DM3Dsx1x.js";import{r as s}from"./vendor-C1mj56OW.js";import{u as t,a,b as r}from"./query-DVbHB3bz.js";import{c as l,u as i,h as n,B as d,e as c,X as o,i as x}from"./index-X1rq4798.js";import{C as m,b as u,c as h,a as j,d as p}from"./card-p4qzoJ3G.js";import{E as b,B as v}from"./badge-CzXJYMmQ.js";import{I as g}from"./input-Da77kd2i.js";import{S as N,a as f,b as y,c as w,d as q,C as k}from"./select-D1Uo6H3q.js";import{T as _,a as C,b as R,c as S,d as A,e as P}from"./table-Bbzn8saC.js";import{D as K,a as B,b as D,c as I,d as F,e as Q,P as M}from"./dialog-xa4sHhbx.js";import{u as L}from"./centered-notification-DA-ZkmnN.js";import{C as O}from"./circle-check-big-DNlgjeLh.js";import{S as T}from"./search-DyLPQ1zL.js";import{f as z}from"./format-BD6kmShm.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";import"./circle-alert-DxqJBH9T.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=l("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),H=l("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function $(){const[,l]=i(),$=n(),V="admin"===(null==$?void 0:$.level)||"petugas"===(null==$?void 0:$.level),{showNotification:W,NotificationComponent:X}=L(),Y=t(),G=(e,s="PPP")=>e?z(new Date(e),s):"-",[J,U]=s.useState(null),[Z,ee]=s.useState(!1),[se,te]=s.useState(!1),[ae,re]=s.useState(""),[le,ie]=s.useState("all"),[ne,de]=s.useState(1),{data:ce,isLoading:oe}=a({queryKey:["/api/loan-requests",{page:ne,search:ae,status:"all"!==le?le:void 0}],enabled:V}),{data:xe}=a({queryKey:["/api/loan-requests/stats"]}),me=r({mutationFn:async e=>{const s=await x("PATCH",`/api/loan-requests/${e}/approve`);if(!s.ok)throw new Error("Failed to approve request");return s.json()},onSuccess:()=>{Y.invalidateQueries({queryKey:["/api/loan-requests"]}),Y.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Y.invalidateQueries({queryKey:["/api/books"]}),Y.invalidateQueries({queryKey:["/api/dashboard/stats"]}),W({title:"Request Approved!",description:"The loan request has been approved successfully",type:"success",duration:3e3}),ee(!1),U(null)}}),ue=r({mutationFn:async e=>{const s=await x("PATCH",`/api/loan-requests/${e}/reject`);if(!s.ok)throw new Error("Failed to reject request");return s.json()},onSuccess:()=>{Y.invalidateQueries({queryKey:["/api/loan-requests"]}),Y.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Y.invalidateQueries({queryKey:["/api/books"]}),Y.invalidateQueries({queryKey:["/api/dashboard/stats"]}),W({title:"Request Rejected",description:"The loan request has been rejected",type:"info",duration:3e3}),ee(!1),U(null)}}),he=r({mutationFn:async e=>{const s=await x("PATCH",`/api/loan-requests/${e}/return`);if(!s.ok)throw new Error("Failed to mark as returned");return s.json()},onSuccess:()=>{Y.invalidateQueries({queryKey:["/api/loan-requests"]}),Y.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Y.invalidateQueries({queryKey:["/api/books"]}),Y.invalidateQueries({queryKey:["/api/dashboard/stats"]}),W({title:"Book Returned!",description:"The book has been marked as returned successfully",type:"success",duration:3e3}),ee(!1),U(null)}}),je=s=>{const t={pending:{label:"Pending",variant:"secondary",className:"bg-orange-100 text-orange-800"},approved:{label:"Approved",variant:"secondary",className:"bg-blue-100 text-blue-800"},on_loan:{label:"On Loan",variant:"secondary",className:"bg-purple-100 text-purple-800"},rejected:{label:"Rejected",variant:"destructive",className:"bg-red-100 text-red-800"},returned:{label:"Returned",variant:"secondary",className:"bg-green-100 text-green-800"},overdue:{label:"Overdue",variant:"destructive",className:"bg-red-100 text-red-800"}},a=t[s]||t.pending;return e.jsx(v,{variant:a.variant,className:a.className,children:a.label})},pe=(e,s)=>{U(e),ee(!0)},be=e=>{if(J)switch(e){case"approve":me.mutate(J.id.toString());break;case"reject":ue.mutate(J.id.toString());break;case"return":he.mutate(J.id.toString())}},ve=e.jsxs(c,{onClick:()=>l("/loan-request"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Loan Request"]});return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(X,{}),V?e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Loan Management"}),ve]})}):e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-end",children:ve})}),e.jsxs("div",{className:"p-6",children:[V&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Pending Requests"}),e.jsx(H,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(null==xe?void 0:xe.pending)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Awaiting approval"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Active Loans"}),e.jsx(d,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(null==xe?void 0:xe.active)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Currently borrowed"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Completed"}),e.jsx(O,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(null==xe?void 0:xe.completed)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Successfully returned"})]})]}),e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Overdue"}),e.jsx(E,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(null==xe?void 0:xe.overdue)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Past due date"})]})]})]}),V&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 bg-white p-4 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search by borrower name, NIK, or book title...",value:ae,onChange:e=>re(e.target.value),className:"pl-10"})]}),e.jsxs(N,{value:le,onValueChange:ie,children:[e.jsx(f,{className:"w-48",children:e.jsx(y,{placeholder:"Filter by status"})}),e.jsxs(w,{children:[e.jsx(q,{value:"all",children:"All Status"}),e.jsx(q,{value:"pending",children:"Pending"}),e.jsx(q,{value:"approved",children:"Approved"}),e.jsx(q,{value:"rejected",children:"Rejected"}),e.jsx(q,{value:"returned",children:"Returned"}),e.jsx(q,{value:"overdue",children:"Overdue"})]})]})]})}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Loan Requests"}),e.jsx(p,{children:"Manage all book loan requests from library users"})]}),e.jsx(j,{children:oe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-slate-500",children:"Loading loan requests..."})}):e.jsxs(_,{children:[e.jsx(C,{children:e.jsxs(R,{children:[e.jsx(S,{children:"Request ID"}),e.jsx(S,{children:"Borrower"}),e.jsx(S,{children:"Book"}),e.jsx(S,{children:"Requested Date"}),e.jsx(S,{children:"Status"}),e.jsx(S,{children:"Actions"})]})}),e.jsx(A,{children:null==ce?void 0:ce.requests.map(s=>e.jsxs(R,{children:[e.jsx(P,{className:"font-mono text-sm",children:s.request_id}),e.jsx(P,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.borrower_name}),e.jsx("div",{className:"text-sm text-slate-500",children:s.employee_nik})]})}),e.jsx(P,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.book_title||"Book ID: "+s.id_buku}),e.jsx("div",{className:"text-sm text-slate-500",children:s.book_author})]})}),e.jsx(P,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:G(s.requested_return_date,"MMM dd, yyyy")}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Submitted: ",z(new Date(s.created_at),"MMM dd")]})]})}),e.jsx(P,{children:je(s.status)}),e.jsx(P,{children:e.jsxs("div",{className:"flex gap-2",children:["pending"===s.status&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>pe(s),children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(c,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>pe(s),children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),"approved"===s.status&&e.jsxs(c,{size:"sm",variant:"outline",className:"text-blue-600 border-blue-600 hover:bg-blue-50",onClick:()=>pe(s),children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Mark Returned"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{U(s),te(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"View"]})]})})]},s.request_id))})]})})]})]}),!V&&e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{className:"text-xl font-bold text-slate-900",children:"How Book Lending Works"}),e.jsx(p,{children:"Simple steps to borrow books from our digital library"})]}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-blue-600 font-bold text-lg",children:"1"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Submit Request"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Fill out the loan request form with your employee NIK and select the book you want to borrow"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-orange-600 font-bold text-lg",children:"2"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Admin Approval"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Your request will be reviewed by the library administrator for approval"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-green-600 font-bold text-lg",children:"3"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Collect & Return"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Once approved, collect your book and return it by the specified due date"})]})]})})]}),e.jsx(K,{open:Z,onOpenChange:ee,children:e.jsxs(B,{children:[e.jsxs(D,{children:[e.jsx(I,{children:"Confirm Action"}),e.jsx(F,{children:J&&e.jsxs(e.Fragment,{children:["Are you sure you want to take this action on request ",J.request_id,"?",e.jsxs("div",{className:"mt-2 p-3 bg-slate-50 rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Borrower:"})," ",J.borrower_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Book ID:"})," ",J.id_buku]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Current Status:"})," ",je(J.status)]})]})]})})]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),"pending"===(null==J?void 0:J.status)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>be("approve"),disabled:me.isPending,children:me.isPending?"Approving...":"Approve"}),e.jsx(c,{variant:"destructive",onClick:()=>be("reject"),disabled:ue.isPending,children:ue.isPending?"Rejecting...":"Reject"})]}),"approved"===(null==J?void 0:J.status)&&e.jsx(c,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>be("return"),disabled:he.isPending,children:he.isPending?"Processing...":"Mark as Returned"})]})]})}),e.jsx(K,{open:se,onOpenChange:te,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(D,{children:[e.jsx(I,{children:"Loan Request Details"}),e.jsx(F,{children:"Detailed information about the loan request"})]}),J&&e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Request ID"}),e.jsx("p",{className:"font-mono text-sm mt-1",children:J.request_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:je(J.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Borrower Name"}),e.jsx("p",{className:"mt-1",children:J.borrower_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Employee NIK"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:J.employee_nik})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Email"}),e.jsx("p",{className:"mt-1",children:J.borrower_email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Phone"}),e.jsx("p",{className:"mt-1",children:J.borrower_phone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Book Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-slate-50 rounded",children:[e.jsx("p",{className:"font-medium",children:J.book_title||`Book ID: ${J.id_buku}`}),J.book_isbn&&e.jsxs("p",{className:"text-sm text-slate-600",children:["ISBN: ",J.book_isbn]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Request Date"}),e.jsx("p",{className:"mt-1",children:G(J.request_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Requested Return Date"}),e.jsx("p",{className:"mt-1",children:G(J.requested_return_date)})]})]}),J.reason&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Reason"}),e.jsx("p",{className:"mt-1 p-3 bg-slate-50 rounded",children:J.reason})]}),J.approval_date&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Approval Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-green-50 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Approved on:"})," ",G(J.approval_date)]}),J.approver_name&&e.jsxs("p",{children:[e.jsx("strong",{children:"Approved by:"})," ",J.approver_name]}),J.approval_notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",J.approval_notes]})]})]}),J.return_date&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Return Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-blue-50 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Returned on:"})," ",G(J.return_date)]}),J.return_notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",J.return_notes]})]})]})]}),e.jsx(Q,{children:e.jsx(c,{variant:"outline",onClick:()=>te(!1),children:"Close"})})]})})]})]})}export{$ as default};
