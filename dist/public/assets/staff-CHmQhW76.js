import{j as e}from"./ui-DM3Dsx1x.js";import{r as t}from"./vendor-C1mj56OW.js";import{u as s,a,b as n}from"./query-DVbHB3bz.js";import{c as i,b as l,h as r,e as d,i as o}from"./index-X1rq4798.js";import{I as c}from"./input-Da77kd2i.js";import{P as m,D as h,a as x,b as p,c as u,d as f,e as j}from"./dialog-xa4sHhbx.js";import{T as v,a as b,b as g,c as _,d as N,e as k}from"./table-Bbzn8saC.js";import{u as y}from"./centered-notification-DA-ZkmnN.js";import{S as C}from"./search-DyLPQ1zL.js";import{S,T as E}from"./trash-2-BG7ECrvZ.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";import"./circle-check-big-DNlgjeLh.js";import"./circle-alert-DxqJBH9T.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=i("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function P(){const{toast:i}=l(),{showNotification:P,NotificationComponent:I}=y(),F=s(),D=r(),K="admin"===(null==D?void 0:D.level)||"petugas"===(null==D?void 0:D.level),A=t.useRef(null),[T,q]=t.useState(1),[O,M]=t.useState(""),[L,R]=t.useState(!1),[U,$]=t.useState(!1),[Q,z]=t.useState(!1),[V,G]=t.useState(!1),[H,B]=t.useState(null),[J,W]=t.useState([]),[X,Y]=t.useState([]),[Z,ee]=t.useState({staff_name:"",initial_name:"",nik:"",section_name:"",department_name:"",dept_name:"",no_hp:"",email:"",status:1,position:"",photo:""}),[te,se]=t.useState({staff_name:"",initial_name:"",nik:"",section_name:"",department_name:"",dept_name:"",no_hp:"",email:"",status:1,position:"",photo:""}),{data:ae,isLoading:ne}=a({queryKey:["/api/staff",{page:T,limit:25,search:O}]}),ie=n({mutationFn:async e=>{const t=await o("POST","/api/staff",e);if(!t.ok)throw new Error("Failed to add staff");return t.json()},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/staff"]}),P({title:"Success!",description:"Staff member added successfully",type:"success",duration:3e3}),R(!1),oe()},onError:e=>{i({title:"Error",description:e.message||"Failed to add staff",variant:"destructive"})}}),le=n({mutationFn:async e=>{const t=await o("PUT",`/api/staff/${e.id}`,e.updates);if(!t.ok)throw new Error("Failed to update staff");return t.json()},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/staff"]}),P({title:"Success!",description:"Staff member updated successfully",type:"success",duration:3e3}),$(!1),B(null)},onError:e=>{i({title:"Error",description:e.message||"Failed to update staff",variant:"destructive"})}}),re=n({mutationFn:async e=>{const t=await o("DELETE",`/api/staff/${e}`);if(!t.ok)throw new Error("Failed to delete staff");return t.json()},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/staff"]}),P({title:"Success!",description:"Staff member deleted successfully",type:"success",duration:3e3}),z(!1),B(null)},onError:e=>{i({title:"Error",description:e.message||"Failed to delete staff",variant:"destructive"})}}),de=n({mutationFn:async e=>{const t=await o("POST","/api/staff/bulk-import",{staffList:e});if(!t.ok)throw new Error("Failed to import staff");return t.json()},onSuccess:e=>{F.invalidateQueries({queryKey:["/api/staff"]}),P({title:"Import Complete!",description:`${e.success} staff imported successfully. ${e.errors.length} errors.`,type:"success",duration:4e3}),G(!1),W([]),Y([])},onError:e=>{i({title:"Error",description:e.message||"Failed to import staff",variant:"destructive"})}}),oe=()=>{ee({staff_name:"",initial_name:"",nik:"",section_name:"",department_name:"",dept_name:"",no_hp:"",email:"",status:1,position:"",photo:""})},ce=(e,t)=>{ee(s=>({...s,[e]:t}))},me=(e,t)=>{se(s=>({...s,[e]:t}))};return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(I,{}),e.jsxs("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-40",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Staff Management"}),K&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>{var e;return null==(e=A.current)?void 0:e.click()},variant:"outline",className:"px-4 py-2 rounded-lg text-sm font-medium",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Import CSV"]}),e.jsxs(d,{onClick:()=>R(!0),className:"bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Add Staff"]})]})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),q(1)},className:"mt-4 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(c,{type:"text",placeholder:"Search by name, NIK, email, or department...",value:O,onChange:e=>M(e.target.value),className:"pl-10"})]}),e.jsx(d,{type:"submit",children:"Search"}),O&&e.jsx(d,{type:"button",variant:"outline",onClick:()=>{M(""),q(1)},children:"Clear"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 text-sm text-slate-600",children:["Total: ",(null==ae?void 0:ae.total)||0," staff members"]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow border",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(g,{children:[e.jsx(_,{children:"NIK"}),e.jsx(_,{children:"Name"}),e.jsx(_,{children:"Department"}),e.jsx(_,{children:"Section"}),e.jsx(_,{children:"Position"}),e.jsx(_,{children:"Email"}),e.jsx(_,{children:"Phone"}),e.jsx(_,{children:"Status"}),e.jsx(_,{className:"text-right",children:"Actions"})]})}),e.jsx(N,{children:ne?e.jsx(g,{children:e.jsx(k,{colSpan:9,children:"Loading..."})}):(null==ae?void 0:ae.staff.length)?ae.staff.map(t=>e.jsxs(g,{children:[e.jsx(k,{className:"font-mono",children:t.nik}),e.jsx(k,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.staff_name}),t.initial_name&&e.jsxs("div",{className:"text-sm text-slate-500",children:["(",t.initial_name,")"]})]})}),e.jsx(k,{children:e.jsxs("div",{children:[e.jsx("div",{children:t.department_name||"-"}),t.dept_name&&e.jsxs("div",{className:"text-sm text-slate-500 font-mono",children:["(",t.dept_name,")"]})]})}),e.jsx(k,{children:t.section_name||"-"}),e.jsx(k,{children:t.position||"-"}),e.jsx(k,{children:t.email||"-"}),e.jsx(k,{children:t.no_hp||"-"}),e.jsx(k,{children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(1===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:1===t.status?"Active":"Inactive"})}),e.jsx(k,{className:"text-right",children:K&&e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>(e=>{B(e),se({staff_name:e.staff_name,initial_name:e.initial_name||"",nik:e.nik,section_name:e.section_name||"",department_name:e.department_name||"",dept_name:e.dept_name||"",no_hp:e.no_hp||"",email:e.email||"",status:e.status,position:e.position||"",photo:e.photo||""}),$(!0)})(t),title:"Edit",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>(e=>{B(e),z(!0)})(t),title:"Delete",className:"text-red-600 hover:text-red-800",children:e.jsx(E,{className:"w-4 h-4"})})]})})]},t.id_staff)):e.jsx(g,{children:e.jsx(k,{colSpan:9,className:"text-center text-slate-500",children:"No staff found"})})})]})}),ae&&ae.total>25&&e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>q(e=>Math.max(1,e-1)),disabled:1===T,children:"Previous"}),e.jsxs("span",{className:"px-4 py-2 text-sm",children:["Page ",T," of ",Math.ceil(ae.total/25)]}),e.jsx(d,{variant:"outline",onClick:()=>q(e=>e+1),disabled:T>=Math.ceil(ae.total/25),children:"Next"})]})]}),e.jsx("input",{ref:A,type:"file",accept:".csv",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{var t;const s=(null==(t=e.target)?void 0:t.result).split("\n"),a=s[0].split(";").map(e=>e.trim()),n=s.slice(1).filter(e=>e.trim()).map(e=>{const t=e.split(";"),s={};return a.forEach((e,a)=>{var n;const i=null==(n=t[a])?void 0:n.trim();s[e]="NULL"===i||""===i?null:i}),s}).map(e=>({staff_name:e.staff_name,initial_name:e.initial_name,nik:e.nik,section_name:e.section_name,department_name:e.department_name,dept_name:e.dept_name,no_hp:"0"===e.no_hp?null:e.no_hp,email:e.email,status:parseInt(e.status)||1,position:e.position,photo:e.photo})).filter(e=>e.nik&&e.staff_name);W(n),Y(n.slice(0,5)),G(!0)},a.readAsText(s)},style:{display:"none"}}),K&&e.jsx(h,{open:L,onOpenChange:R,children:e.jsxs(x,{className:"max-w-2xl",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Add New Staff"}),e.jsx(f,{children:"Fill in the staff information."})]}),e.jsx("div",{className:"py-4 space-y-4 max-h-96 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Staff Name *"}),e.jsx(c,{value:Z.staff_name,onChange:e=>ce("staff_name",e.target.value),placeholder:"Enter staff name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIK *"}),e.jsx(c,{value:Z.nik,onChange:e=>ce("nik",e.target.value),placeholder:"Enter NIK"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Initial Name"}),e.jsx(c,{value:Z.initial_name,onChange:e=>ce("initial_name",e.target.value),placeholder:"Enter initial name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department Code"}),e.jsx(c,{value:Z.dept_name,onChange:e=>ce("dept_name",e.target.value),placeholder:"e.g., DIAD, CROP, AGRO"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department Name"}),e.jsx(c,{value:Z.department_name,onChange:e=>ce("department_name",e.target.value),placeholder:"Enter department name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Section"}),e.jsx(c,{value:Z.section_name,onChange:e=>ce("section_name",e.target.value),placeholder:"Enter section name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position"}),e.jsx(c,{value:Z.position,onChange:e=>ce("position",e.target.value),placeholder:"Enter position"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),e.jsx(c,{value:Z.no_hp,onChange:e=>ce("no_hp",e.target.value),placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx(c,{type:"email",value:Z.email,onChange:e=>ce("email",e.target.value),placeholder:"Enter email address"})]})]})}),e.jsxs(j,{children:[e.jsx(d,{variant:"outline",onClick:()=>R(!1),disabled:ie.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{Z.staff_name&&Z.nik&&ie.mutate(Z)},disabled:ie.isPending||!Z.staff_name||!Z.nik,className:"bg-primary hover:bg-blue-700",children:ie.isPending?"Adding...":"Add Staff"})]})]})}),e.jsx(h,{open:V,onOpenChange:G,children:e.jsxs(x,{className:"max-w-4xl",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Import Staff from CSV"}),e.jsxs(f,{children:["Review the data to be imported. ",J.length," records found."]})]}),e.jsxs("div",{className:"py-4",children:[X.length>0&&e.jsx("div",{className:"overflow-x-auto rounded border",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(g,{children:[e.jsx(_,{children:"Name"}),e.jsx(_,{children:"NIK"}),e.jsx(_,{children:"Department"}),e.jsx(_,{children:"Email"}),e.jsx(_,{children:"Phone"})]})}),e.jsx(N,{children:X.map((t,s)=>e.jsxs(g,{children:[e.jsx(k,{children:t.staff_name}),e.jsx(k,{children:t.nik}),e.jsx(k,{children:t.dept_name}),e.jsx(k,{children:t.email||"-"}),e.jsx(k,{children:t.no_hp||"-"})]},s))})]})}),J.length>5&&e.jsxs("p",{className:"text-sm text-slate-600 mt-2",children:["... and ",J.length-5," more records"]})]}),e.jsxs(j,{children:[e.jsx(d,{variant:"outline",onClick:()=>G(!1),disabled:de.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{0!==J.length&&de.mutate(J)},disabled:de.isPending||0===J.length,className:"bg-primary hover:bg-blue-700",children:de.isPending?"Importing...":`Import ${J.length} Records`})]})]})}),K&&e.jsx(h,{open:U,onOpenChange:$,children:e.jsxs(x,{className:"max-w-2xl",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Edit Staff Member"}),e.jsx(f,{children:"Update the staff member information below."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name *"}),e.jsx(c,{value:te.staff_name,onChange:e=>me("staff_name",e.target.value),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Initial Name"}),e.jsx(c,{value:te.initial_name,onChange:e=>me("initial_name",e.target.value),placeholder:"Enter initial name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIK *"}),e.jsx(c,{value:te.nik,onChange:e=>me("nik",e.target.value),placeholder:"Enter NIK",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position"}),e.jsx(c,{value:te.position,onChange:e=>me("position",e.target.value),placeholder:"Enter position"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Section"}),e.jsx(c,{value:te.section_name,onChange:e=>me("section_name",e.target.value),placeholder:"Enter section"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department"}),e.jsx(c,{value:te.department_name,onChange:e=>me("department_name",e.target.value),placeholder:"Enter department"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department Code"}),e.jsx(c,{value:te.dept_name,onChange:e=>me("dept_name",e.target.value),placeholder:"Enter dept code"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone Number"}),e.jsx(c,{value:te.no_hp,onChange:e=>me("no_hp",e.target.value),placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx(c,{type:"email",value:te.email,onChange:e=>me("email",e.target.value),placeholder:"Enter email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Status"}),e.jsxs("select",{value:te.status,onChange:e=>me("status",parseInt(e.target.value)),className:"w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:1,children:"Active"}),e.jsx("option",{value:0,children:"Inactive"})]})]})]})}),e.jsxs(j,{children:[e.jsx(d,{variant:"outline",onClick:()=>$(!1),disabled:le.isPending,children:"Cancel"}),e.jsx(d,{onClick:()=>{H&&le.mutate({id:H.id_staff,updates:te})},disabled:le.isPending||!te.staff_name||!te.nik,className:"bg-primary hover:bg-blue-700",children:le.isPending?"Updating...":"Update Staff"})]})]})}),K&&e.jsx(h,{open:Q,onOpenChange:z,children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(u,{children:"Delete Staff Member"}),e.jsxs(f,{children:["Are you sure you want to delete ",null==H?void 0:H.staff_name,"? This action cannot be undone."]})]}),e.jsxs(j,{children:[e.jsx(d,{variant:"outline",onClick:()=>z(!1),disabled:re.isPending,children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:()=>{H&&re.mutate(H.id_staff)},disabled:re.isPending,children:re.isPending?"Deleting...":"Delete"})]})]})})]})}export{P as default};
