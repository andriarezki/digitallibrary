import{j as e}from"./ui-DM3Dsx1x.js";import{r as s}from"./vendor-C1mj56OW.js";import{u as a,a as l,b as r}from"./query-DVbHB3bz.js";import{b as i,h as n,e as t,i as d}from"./index-X1rq4798.js";import{I as c}from"./input-Da77kd2i.js";import{P as o,D as u,a as m,b as h,c as x,d as j,e as p}from"./dialog-xa4sHhbx.js";import{T as v,a as g,b,c as f,d as N,e as w}from"./table-Bbzn8saC.js";import{S as y,T as k}from"./trash-2-BG7ECrvZ.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";function E(){const{toast:E}=i(),C=a(),S=n(),P="admin"===(null==S?void 0:S.level)||"petugas"===(null==S?void 0:S.level),[U,F]=s.useState(!1),[A,D]=s.useState(!1),[L,T]=s.useState(!1),[q,K]=s.useState(null),[O,z]=s.useState({user:"",pass:""}),[Q,_]=s.useState({user:"",pass:"",nama:"",email:"",level:""}),{data:$,isLoading:I}=l({queryKey:["/api/users",{page:1,limit:50}]}),M=r({mutationFn:async e=>{const s=await d("POST","/api/users",e);if(!s.ok)throw new Error("Failed to add user");return s.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/users"]}),E({title:"Success",description:"User added successfully"}),F(!1),z({user:"",pass:""})},onError:e=>{E({title:"Error",description:e.message||"Failed to add user",variant:"destructive"})}}),B=r({mutationFn:async e=>{const s=await d("PUT",`/api/users/${e.id}`,e.updates);if(!s.ok)throw new Error("Failed to update user");return s.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/users"]}),E({title:"Success",description:"User updated successfully"}),D(!1),K(null)},onError:e=>{E({title:"Error",description:e.message||"Failed to update user",variant:"destructive"})}}),G=r({mutationFn:async e=>{const s=await d("DELETE",`/api/users/${e}`);if(!s.ok)throw new Error("Failed to delete user");return s.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/users"]}),E({title:"Success",description:"User deleted successfully"}),T(!1),K(null)},onError:e=>{E({title:"Error",description:e.message||"Failed to delete user",variant:"destructive"})}}),H=(e,s)=>{z(a=>({...a,[e]:s}))},J=(e,s)=>{_(a=>({...a,[e]:s}))};return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Users Management"}),P&&e.jsxs(t,{onClick:()=>F(!0),className:"bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Add User"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto rounded-lg shadow border",children:e.jsxs(v,{children:[e.jsx(g,{children:e.jsxs(b,{children:[e.jsx(f,{children:"Username"}),e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Level"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsx(N,{children:I?e.jsx(b,{children:e.jsx(w,{colSpan:5,children:"Loading..."})}):(null==$?void 0:$.users.length)?$.users.map(s=>e.jsxs(b,{children:[e.jsx(w,{children:s.user}),e.jsx(w,{children:s.nama||"-"}),e.jsx(w,{children:s.email||"-"}),e.jsx(w,{children:s.level||"-"}),e.jsx(w,{className:"text-right",children:P&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(e=>{K(e),_({user:e.user||"",pass:"",nama:e.nama||"",email:e.email||"",level:e.level||""}),D(!0)})(s),title:"Edit",children:e.jsx(y,{className:"w-4 h-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(e=>{K(e),T(!0)})(s),title:"Delete",className:"text-red-600 hover:text-red-800",children:e.jsx(k,{className:"w-4 h-4"})})]})})]},s.id_login)):e.jsx(b,{children:e.jsx(w,{colSpan:5,className:"text-center text-slate-500",children:"No users found"})})})]})})}),P&&e.jsx(u,{open:U,onOpenChange:F,children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Add New User"}),e.jsx(j,{children:"Fill in the username and password for the new user."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username *"}),e.jsx(c,{value:O.user,onChange:e=>H("user",e.target.value),placeholder:"Enter username",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password *"}),e.jsx(c,{type:"password",value:O.pass,onChange:e=>H("pass",e.target.value),placeholder:"Enter password",className:"w-full"})]})]}),e.jsxs(p,{children:[e.jsx(t,{variant:"outline",onClick:()=>F(!1),disabled:M.isPending,children:"Cancel"}),e.jsx(t,{onClick:()=>{O.user&&O.pass&&M.mutate(O)},disabled:M.isPending||!O.user||!O.pass,className:"bg-primary hover:bg-blue-700",children:M.isPending?"Adding...":"Add User"})]})]})}),P&&e.jsx(u,{open:A,onOpenChange:D,children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Edit User"}),e.jsx(j,{children:"Edit the user information. Leave password blank to keep unchanged."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Username *"}),e.jsx(c,{value:Q.user,onChange:e=>J("user",e.target.value),placeholder:"Enter username",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),e.jsx(c,{type:"password",value:Q.pass,onChange:e=>J("pass",e.target.value),placeholder:"Enter new password (leave blank to keep current)",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Name"}),e.jsx(c,{value:Q.nama,onChange:e=>J("nama",e.target.value),placeholder:"Enter name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx(c,{value:Q.email,onChange:e=>J("email",e.target.value),placeholder:"Enter email",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Level"}),e.jsx(c,{value:Q.level,onChange:e=>J("level",e.target.value),placeholder:"Enter level (e.g. admin, user)",className:"w-full"})]})]}),e.jsxs(p,{children:[e.jsx(t,{variant:"outline",onClick:()=>D(!1),disabled:B.isPending,children:"Cancel"}),e.jsx(t,{onClick:()=>{if(!q)return;const e={user:Q.user,nama:Q.nama,email:Q.email,level:Q.level};Q.pass&&(e.pass=Q.pass),B.mutate({id:q.id_login,updates:e})},disabled:B.isPending||!Q.user,className:"bg-primary hover:bg-blue-700",children:B.isPending?"Saving...":"Save Changes"})]})]})}),P&&e.jsx(u,{open:L,onOpenChange:T,children:e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Delete User"}),e.jsxs(j,{children:["Are you sure you want to delete user"," ",e.jsx("b",{children:null==q?void 0:q.user}),"? This action cannot be undone."]})]}),e.jsxs(p,{children:[e.jsx(t,{variant:"outline",onClick:()=>T(!1),disabled:G.isPending,children:"Cancel"}),e.jsx(t,{onClick:()=>{q&&G.mutate(q.id_login)},disabled:G.isPending,className:"bg-red-600 hover:bg-red-700",children:G.isPending?"Deleting...":"Delete"})]})]})})]})}export{E as default};
