import{j as e}from"./ui-DM3Dsx1x.js";import{r as s}from"./vendor-C1mj56OW.js";import{u as a,a as t,b as l}from"./query-DVbHB3bz.js";import{c as r,u as i,h as n,B as d,e as c,X as o,i as m}from"./index-gAofG3DC.js";import{C as x,b as u,c as h,a as j,d as p}from"./card-N8uJmbSa.js";import{E as b,B as v}from"./badge-C_9zzwqd.js";import{f as g,a as N,A as f,b as y}from"./format-BLvlu-GI.js";import{I as w}from"./input-BWzlW1-9.js";import{S as q,a as k,b as _,c as C,d as R,C as S}from"./select-1He4EU54.js";import{T as A,a as P,b as D,c as K,d as M,e as B}from"./table-WlU8LpAd.js";import{D as I,a as F,b as Q,c as T,d as L,e as O,P as z}from"./dialog-DwQBQQSc.js";import{u as E}from"./centered-notification-Bm8OzNBk.js";import{C as $}from"./circle-check-big-CW-HGMI4.js";import{S as H}from"./search-Bi60RsYc.js";import"./pdf-QG3cfAWJ.js";import"./charts-CWC3ycSS.js";import"./circle-alert-CiRyCPvy.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=r("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),W=r("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),X=14;
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Y(){const[,r]=i(),Y=n(),G="admin"===(null==Y?void 0:Y.level)||"petugas"===(null==Y?void 0:Y.level),{showNotification:J,NotificationComponent:U}=E(),Z=a(),ee=(e,s="PPP")=>e?g(new Date(e),s):"-",[se,ae]=s.useState(null),[te,le]=s.useState(!1),[re,ie]=s.useState(!1),[ne,de]=s.useState(""),[ce,oe]=s.useState("all"),[me,xe]=s.useState(1),ue=s.useMemo(()=>g(N(new Date,X),"PPP"),[]),{data:he,isLoading:je}=t({queryKey:["/api/loan-requests",{page:me,search:ne,status:"all"!==ce?ce:void 0}],enabled:G}),{data:pe}=t({queryKey:["/api/loan-requests/stats"]}),be=l({mutationFn:async e=>{const s=await m("PATCH",`/api/loan-requests/${e}/approve`);if(!s.ok)throw new Error("Failed to approve request");return s.json()},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/loan-requests"]}),Z.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Z.invalidateQueries({queryKey:["/api/books"]}),Z.invalidateQueries({queryKey:["/api/dashboard/stats"]}),J({title:"Request Approved!",description:"The loan request has been approved successfully",type:"success",duration:3e3}),le(!1),ae(null)}}),ve=l({mutationFn:async e=>{const s=await m("PATCH",`/api/loan-requests/${e}/reject`);if(!s.ok)throw new Error("Failed to reject request");return s.json()},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/loan-requests"]}),Z.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Z.invalidateQueries({queryKey:["/api/books"]}),Z.invalidateQueries({queryKey:["/api/dashboard/stats"]}),J({title:"Request Rejected",description:"The loan request has been rejected",type:"info",duration:3e3}),le(!1),ae(null)}}),ge=l({mutationFn:async e=>{const s=await m("PATCH",`/api/loan-requests/${e}/return`);if(!s.ok)throw new Error("Failed to mark as returned");return s.json()},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/loan-requests"]}),Z.invalidateQueries({queryKey:["/api/loan-requests/stats"]}),Z.invalidateQueries({queryKey:["/api/books"]}),Z.invalidateQueries({queryKey:["/api/dashboard/stats"]}),J({title:"Book Returned!",description:"The book has been marked as returned successfully",type:"success",duration:3e3}),le(!1),ae(null)}}),Ne=s=>{const a={pending:{label:"Pending",variant:"secondary",className:"bg-orange-100 text-orange-800"},approved:{label:"Approved",variant:"secondary",className:"bg-blue-100 text-blue-800"},on_loan:{label:"On Loan",variant:"secondary",className:"bg-purple-100 text-purple-800"},rejected:{label:"Rejected",variant:"destructive",className:"bg-red-100 text-red-800"},returned:{label:"Returned",variant:"secondary",className:"bg-green-100 text-green-800"},overdue:{label:"Overdue",variant:"destructive",className:"bg-red-100 text-red-800"}},t=a[s]||a.pending;return e.jsx(v,{variant:t.variant,className:t.className,children:t.label})},fe=(e,s)=>{ae(e),le(!0)},ye=e=>{if(se)switch(e){case"approve":be.mutate(se.id.toString());break;case"reject":ve.mutate(se.id.toString());break;case"return":ge.mutate(se.id.toString())}},we=e.jsxs(c,{onClick:()=>r("/loan-request"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"New Loan Request"]});return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(U,{}),G?e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Loan Management"}),we]})}):e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4",children:e.jsx("div",{className:"flex items-center justify-end",children:we})}),e.jsxs("div",{className:"p-6",children:[G&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(x,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Pending Requests"}),e.jsx(W,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(null==pe?void 0:pe.pending)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Awaiting approval"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Active Loans"}),e.jsx(d,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(null==pe?void 0:pe.active)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Currently borrowed"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Completed"}),e.jsx($,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(null==pe?void 0:pe.completed)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Successfully returned"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-slate-600",children:"Overdue"}),e.jsx(V,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(null==pe?void 0:pe.overdue)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Past due date"})]})]})]}),G&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6 bg-white p-4 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(w,{placeholder:"Search by borrower name, NIK, or book title...",value:ne,onChange:e=>de(e.target.value),className:"pl-10"})]}),e.jsxs(q,{value:ce,onValueChange:oe,children:[e.jsx(k,{className:"w-48",children:e.jsx(_,{placeholder:"Filter by status"})}),e.jsxs(C,{children:[e.jsx(R,{value:"all",children:"All Status"}),e.jsx(R,{value:"pending",children:"Pending"}),e.jsx(R,{value:"approved",children:"Approved"}),e.jsx(R,{value:"rejected",children:"Rejected"}),e.jsx(R,{value:"returned",children:"Returned"}),e.jsx(R,{value:"overdue",children:"Overdue"})]})]})]})}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Loan Requests"}),e.jsx(p,{children:"Manage all book loan requests from library users"})]}),e.jsxs(j,{children:[e.jsx(f,{className:"mb-4 border-amber-200 bg-amber-50",children:e.jsxs(y,{className:"text-amber-800",children:["Approving a request will automatically lock the due date to ",X," days after approval."]})}),je?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-slate-500",children:"Loading loan requests..."})}):e.jsxs(A,{children:[e.jsx(P,{children:e.jsxs(D,{children:[e.jsx(K,{children:"Request ID"}),e.jsx(K,{children:"Borrower"}),e.jsx(K,{children:"Book"}),e.jsx(K,{children:"Requested Date"}),e.jsx(K,{children:"Status"}),e.jsx(K,{children:"Actions"})]})}),e.jsx(M,{children:null==he?void 0:he.requests.map(s=>e.jsxs(D,{children:[e.jsx(B,{className:"font-mono text-sm",children:s.request_id}),e.jsx(B,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.borrower_name}),e.jsx("div",{className:"text-sm text-slate-500",children:s.employee_nik})]})}),e.jsx(B,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.book_title||"Book ID: "+s.id_buku}),e.jsx("div",{className:"text-sm text-slate-500",children:s.book_author})]})}),e.jsx(B,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:ee(s.requested_return_date,"MMM dd, yyyy")}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Submitted: ",g(new Date(s.created_at),"MMM dd")]}),s.due_date&&e.jsxs("div",{className:"text-xs text-amber-700 mt-1",children:["Due date: ",ee(s.due_date,"MMM dd, yyyy")," (auto-set)"]})]})}),e.jsx(B,{children:Ne(s.status)}),e.jsx(B,{children:e.jsxs("div",{className:"flex gap-2",children:["pending"===s.status&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{size:"sm",variant:"outline",className:"text-green-600 border-green-600 hover:bg-green-50",onClick:()=>fe(s),children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(c,{size:"sm",variant:"outline",className:"text-red-600 border-red-600 hover:bg-red-50",onClick:()=>fe(s),children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),"approved"===s.status&&e.jsxs(c,{size:"sm",variant:"outline",className:"text-blue-600 border-blue-600 hover:bg-blue-50",onClick:()=>fe(s),children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Mark Returned"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{ae(s),ie(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"View"]})]})})]},s.request_id))})]})]})]})]}),!G&&e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{className:"text-xl font-bold text-slate-900",children:"How Book Lending Works"}),e.jsx(p,{children:"Simple steps to borrow books from our digital library"})]}),e.jsxs(j,{children:[e.jsx(f,{className:"mb-6 border-amber-200 bg-amber-50",children:e.jsxs(y,{className:"text-amber-800",children:["The maximum loan period is ",X," days from approval. The system will automatically set and lock your due date when the request is approved."]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-blue-600 font-bold text-lg",children:"1"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Submit Request"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Fill out the loan request form with your employee NIK and select the book you want to borrow"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-orange-600 font-bold text-lg",children:"2"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Admin Approval"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Your request will be reviewed by the library administrator for approval"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-green-600 font-bold text-lg",children:"3"})}),e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Collect & Return"}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Once approved, collect your book and return it within ",X," days. The due date is automatically locked when your request is approved."]})]})]})]})]}),e.jsx(I,{open:te,onOpenChange:le,children:e.jsxs(F,{children:[e.jsxs(Q,{children:[e.jsx(T,{children:"Confirm Action"}),e.jsx(L,{children:se&&e.jsxs(e.Fragment,{children:["Are you sure you want to take this action on request ",se.request_id,"?",e.jsxs("div",{className:"mt-2 p-3 bg-slate-50 rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Borrower:"})," ",se.borrower_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Book ID:"})," ",se.id_buku]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Current Status:"})," ",Ne(se.status)]})]}),"pending"===se.status&&e.jsxs("p",{className:"mt-3 text-sm text-amber-700",children:["Approving right now will automatically set the due date to ",ue," (maximum of ",X," days from approval)."]})]})})]}),e.jsxs(O,{children:[e.jsx(c,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),"pending"===(null==se?void 0:se.status)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>ye("approve"),disabled:be.isPending,children:be.isPending?"Approving...":"Approve"}),e.jsx(c,{variant:"destructive",onClick:()=>ye("reject"),disabled:ve.isPending,children:ve.isPending?"Rejecting...":"Reject"})]}),"approved"===(null==se?void 0:se.status)&&e.jsx(c,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>ye("return"),disabled:ge.isPending,children:ge.isPending?"Processing...":"Mark as Returned"})]})]})}),e.jsx(I,{open:re,onOpenChange:ie,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsxs(Q,{children:[e.jsx(T,{children:"Loan Request Details"}),e.jsx(L,{children:"Detailed information about the loan request"})]}),se&&e.jsxs("div",{className:"grid gap-4",children:[e.jsx(f,{className:"border-amber-200 bg-amber-50",children:e.jsxs(y,{className:"text-amber-800",children:["Maximum loan period is ",X," days from approval. ",se.due_date?`This request's due date is ${ee(se.due_date)}.`:"The due date will be assigned automatically when the request is approved."]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Request ID"}),e.jsx("p",{className:"font-mono text-sm mt-1",children:se.request_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:Ne(se.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Borrower Name"}),e.jsx("p",{className:"mt-1",children:se.borrower_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Employee NIK"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:se.employee_nik})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Email"}),e.jsx("p",{className:"mt-1",children:se.borrower_email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Phone"}),e.jsx("p",{className:"mt-1",children:se.borrower_phone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Book Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-slate-50 rounded",children:[e.jsx("p",{className:"font-medium",children:se.book_title||`Book ID: ${se.id_buku}`}),se.book_isbn&&e.jsxs("p",{className:"text-sm text-slate-600",children:["ISBN: ",se.book_isbn]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Request Date"}),e.jsx("p",{className:"mt-1",children:ee(se.request_date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Requested Return Date"}),e.jsx("p",{className:"mt-1",children:ee(se.requested_return_date)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Due Date"}),e.jsx("p",{className:"mt-1",children:se.due_date?ee(se.due_date):"Will be set at approval (14-day limit)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Loan Date"}),e.jsx("p",{className:"mt-1",children:ee(se.loan_date)})]})]}),se.reason&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Reason"}),e.jsx("p",{className:"mt-1 p-3 bg-slate-50 rounded",children:se.reason})]}),se.approval_date&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Approval Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-green-50 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Approved on:"})," ",ee(se.approval_date)]}),se.approver_name&&e.jsxs("p",{children:[e.jsx("strong",{children:"Approved by:"})," ",se.approver_name]}),se.approval_notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",se.approval_notes]})]})]}),se.return_date&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-600",children:"Return Information"}),e.jsxs("div",{className:"mt-1 p-3 bg-blue-50 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Returned on:"})," ",ee(se.return_date)]}),se.return_notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",se.return_notes]})]})]})]}),e.jsx(O,{children:e.jsx(c,{variant:"outline",onClick:()=>ie(!1),children:"Close"})})]})})]})]})}export{Y as default};
